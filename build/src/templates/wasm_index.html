<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Bahasa WebAssembly</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .output { background-color: #f8f8f8; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-top: 20px; white-space: pre-wrap; font-family: monospace; }
        button { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Bahasa WebAssembly Demo</h1>
        <button onclick="runMain()">Jalankan Program</button>
        <div id="output" class="output"></div>
    </div>

    <script>
        const output = document.getElementById("output");
        const originalLog = console.log;
        console.log = function() {
            output.textContent += Array.from(arguments).join(" ") + "\n";
            originalLog.apply(console, arguments);
        };

        let wasmInstance = null;

        // Create WebAssembly memory with initial 256 pages (16MB)
        const memory = new WebAssembly.Memory({ initial: 256, maximum: 512 });

        async function loadWasm() {
            try {
                const response = await fetch("{{WASM_FILE}}");
                const bytes = await response.arrayBuffer();
                const obj = await WebAssembly.instantiate(bytes, {
                    env: {
                        memory: memory,
                        __memory_base: 0,
                        __table_base: 0,
                        __stack_pointer: new WebAssembly.Global({value: 'i32', mutable: true}, 0),
                        print: function(val) {
                            console.log(val);
                        },
                        abort: function(msg, file, line, column) {
                            console.error("Abort:", msg, file, line, column);
                        }
                    }
                });
                wasmInstance = obj.instance;
                console.log("Module WASM berhasil dimuat!");
            } catch (err) {
                console.log("Galat saat memuat WASM:", err);
                console.error(err);
            }
        }

        function runMain() {
            output.textContent = "";
            if (wasmInstance && wasmInstance.exports.main) {
                try {
                    const result = wasmInstance.exports.main();
                    console.log("Program selesai dengan kode:", result);
                } catch (err) {
                    console.log("Galat saat menjalankan program:", err);
                    console.error(err);
                }
            } else {
                console.log("Module WASM belum dimuat atau tidak memiliki fungsi main");
            }
        }

        loadWasm();
    </script>
</body>
</html> 